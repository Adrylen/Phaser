Phaser.Plugin.Isometric=function(t,i,s){s=s||Phaser.Plugin.Isometric.CLASSIC,Phaser.Plugin.call(this,t,i),this.projector=new Phaser.Plugin.Isometric.Projector(this.game,s),this.game.iso=this.game.iso||this.projector},Phaser.Plugin.Isometric.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Isometric.prototype.constructor=Phaser.Plugin.Isometric,Phaser.Plugin.Isometric.VERSION="0.9.3",Phaser.Plugin.Isometric.UP=0,Phaser.Plugin.Isometric.DOWN=1,Phaser.Plugin.Isometric.FORWARDX=2,Phaser.Plugin.Isometric.FORWARDY=3,Phaser.Plugin.Isometric.BACKWARDX=4,Phaser.Plugin.Isometric.BACKWARDY=5,Phaser.Plugin.Isometric.ISOSPRITE="isosprite",Phaser.Plugin.Isometric.ISOARCADE="isoarcade",Phaser.Plugin.Isometric.Cube=function(t,i,s,e,o,h){t=t||0,i=i||0,s=s||0,e=e||0,o=o||0,h=h||0,this.x=t,this.y=i,this.z=s,this.widthX=e,this.widthY=o,this.height=h,this._corners=[new Phaser.Plugin.Isometric.Point3(this.x,this.y,this.z),new Phaser.Plugin.Isometric.Point3(this.x,this.y,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x,this.y+this.widthY,this.z),new Phaser.Plugin.Isometric.Point3(this.x,this.y+this.widthY,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y,this.z),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y+this.widthY,this.z),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]},Phaser.Plugin.Isometric.Cube.prototype.constructor=Phaser.Plugin.Isometric.Cube,Phaser.Plugin.Isometric.Cube.prototype={setTo:function(t,i,s,e,o,h){return this.x=t,this.y=i,this.z=s,this.widthX=e,this.widthY=o,this.height=h,this},copyFrom:function(t){this.setTo(t.x,t.y,t.z,t.widthX,t.widthY,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.widthX=this.widthX,t.widthY=this.widthY,t.height=this.height,t},size:function(t){return Phaser.Plugin.Isometric.Cube.size(this,t)},contains:function(t,i,s){return Phaser.Plugin.Isometric.Cube.contains(this,t,i,s)},containsXY:function(t,i){return Phaser.Plugin.Isometric.Cube.containsXY(this,t,i)},clone:function(t){return Phaser.Plugin.Isometric.Cube.clone(this,t)},intersects:function(t){return Phaser.Plugin.Isometric.Cube.intersects(this,t)},getCorners:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners},toString:function(){return"[{Cube (x="+this.x+" y="+this.y+" z="+this.z+" widthX="+this.widthX+" widthY="+this.widthY+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"halfWidthX",{get:function(){return Math.round(.5*this.widthX)}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"halfWidthY",{get:function(){return Math.round(.5*this.widthY)}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"halfHeight",{get:function(){return Math.round(.5*this.height)}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"bottom",{get:function(){return this.z},set:function(t){t>=this.top?this.height=0:this.height=this.top-t,this.z=t}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"top",{get:function(){return this.z+this.height},set:function(t){t<=this.z?this.height=0:this.height=t-this.z}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"backX",{get:function(){return this.x},set:function(t){t>=this.frontX?this.widthX=0:this.widthX=this.frontX-t,this.x=t}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"backY",{get:function(){return this.y},set:function(t){t>=this.frontY?this.widthY=0:this.widthY=this.frontY-t,this.y=t}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"frontX",{get:function(){return this.x+this.widthX},set:function(t){t<=this.x?this.widthX=0:this.widthX=t-this.x}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"frontY",{get:function(){return this.y+this.widthY},set:function(t){t<=this.y?this.widthY=0:this.widthY=t-this.y}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"volume",{get:function(){return this.widthX*this.widthY*this.height}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"centerX",{get:function(){return this.x+this.halfWidthX},set:function(t){this.x=t-this.halfWidthX}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"centerY",{get:function(){return this.y+this.halfWidthY},set:function(t){this.y=t-this.halfWidthY}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"centerZ",{get:function(){return this.z+this.halfHeight},set:function(t){this.z=t-this.halfHeight}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"randomX",{get:function(){return this.x+Math.random()*this.widthX}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"randomY",{get:function(){return this.y+Math.random()*this.widthY}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"randomZ",{get:function(){return this.z+Math.random()*this.height}}),Object.defineProperty(Phaser.Plugin.Isometric.Cube.prototype,"empty",{get:function(){return!this.widthX||!this.widthY||!this.height},set:function(t){t===!0&&this.setTo(0,0,0,0,0,0)}}),Phaser.Plugin.Isometric.Cube.size=function(t,i){return"undefined"==typeof i||null===i?i=new Phaser.Plugin.Isometric.Point3(t.widthX,t.widthY,t.height):i.setTo(t.widthX,t.widthY,t.height),i},Phaser.Plugin.Isometric.Cube.clone=function(t,i){return"undefined"==typeof i||null===i?i=new Phaser.Plugin.Isometric.Cube(t.x,t.y,t.z,t.widthX,t.widthY,t.height):i.setTo(t.x,t.y,t.z,t.widthX,t.widthY,t.height),i},Phaser.Plugin.Isometric.Cube.contains=function(t,i,s,e){return t.widthX<=0||t.widthY<=0||t.height<=0?!1:i>=t.x&&i<=t.frontX&&s>=t.y&&s<=t.frontY&&e>=t.z&&e<=t.top},Phaser.Plugin.Isometric.Cube.containsXY=function(t,i,s){return t.widthX<=0||t.widthY<=0?!1:i>=t.x&&i<=t.frontX&&s>=t.y&&s<=t.frontY},Phaser.Plugin.Isometric.Cube.containsPoint3=function(t,i){return Phaser.Plugin.Isometric.Cube.contains(t,i.x,i.y,i.z)},Phaser.Plugin.Isometric.Cube.containsCube=function(t,i){return t.volume>i.volume?!1:t.x>=i.x&&t.y>=i.y&&t.z>=i.z&&t.frontX<=i.frontX&&t.frontY<=i.frontY&&t.top<=i.top},Phaser.Plugin.Isometric.Cube.intersects=function(t,i){return t.widthX<=0||t.widthY<=0||t.height<=0||i.widthX<=0||i.widthY<=0||i.height<=0?!1:!(t.frontX<i.x||t.frontY<i.y||t.x>i.frontX||t.y>i.frontY||t.z>i.top||t.top<i.z)},Phaser.Plugin.Isometric.IsoSprite=function(t,i,s,e,o,h){Phaser.Sprite.call(this,t,i,s,o,h),this.type=Phaser.Plugin.Isometric.ISOSPRITE,this._isoPosition=new Phaser.Plugin.Isometric.Point3(i,s,e),this.snap=0,this._depth=0,this._depthChanged=!0,this._isoPositionChanged=!0,this._isoBoundsChanged=!0,this._project(),this._isoBounds=this.resetIsoBounds()},Phaser.Plugin.Isometric.IsoSprite.prototype=Object.create(Phaser.Sprite.prototype),Phaser.Plugin.Isometric.IsoSprite.prototype.constructor=Phaser.Plugin.Isometric.IsoSprite,Phaser.Plugin.Isometric.IsoSprite.prototype.postUpdate=function(){Phaser.Sprite.prototype.postUpdate.call(this),this._project()},Phaser.Plugin.Isometric.IsoSprite.prototype._project=function(){this._isoPositionChanged&&(this.game.iso.project(this._isoPosition,this.position),this.snap>0&&(this.position.x=Phaser.Math.snapTo(this.position.x,this.snap),this.position.y=Phaser.Math.snapTo(this.position.y,this.snap)),this._depthChanged=this._isoPositionChanged=this._isoBoundsChanged=!0)},Phaser.Plugin.Isometric.IsoSprite.prototype.resetIsoBounds=function(){"undefined"==typeof this._isoBounds&&(this._isoBounds=new Phaser.Plugin.Isometric.Cube);var t=Math.abs(this.scale.x),i=Math.abs(this.scale.y);return this._isoBounds.widthX=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.widthY=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.height=Math.round(Math.abs(this.height)-.5*Math.abs(this.width))*i,this._isoBounds.x=this.isoX+this._isoBounds.widthX*-this.anchor.x+.5*this._isoBounds.widthX,this._isoBounds.y=this.isoY+this._isoBounds.widthY*this.anchor.x-.5*this._isoBounds.widthY,this._isoBounds.z=this.isoZ-Math.abs(this.height)*(1-this.anchor.y)+Math.abs(.5*this.width),this._isoBounds},Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"isoX",{get:function(){return this._isoPosition.x},set:function(t){this._isoPosition.x=t,this._depthChanged=this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}}),Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"isoY",{get:function(){return this._isoPosition.y},set:function(t){this._isoPosition.y=t,this._depthChanged=this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}}),Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"isoZ",{get:function(){return this._isoPosition.z},set:function(t){this._isoPosition.z=t,this._depthChanged=this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}}),Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"isoPosition",{get:function(){return this._isoPosition}}),Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"isoBounds",{get:function(){return!this._isoBoundsChanged&&this._isoBounds||(this.resetIsoBounds(),this._isoBoundsChanged=!1),this._isoBounds}}),Object.defineProperty(Phaser.Plugin.Isometric.IsoSprite.prototype,"depth",{get:function(){return this._depthChanged===!0&&(this._depth=this._isoPosition.x+this._isoPosition.y+1.25*this._isoPosition.z,this._depthChanged=!1),this._depth}}),Phaser.GameObjectCreator.prototype.isoSprite=function(t,i,s,e,o){return new Phaser.Plugin.Isometric.IsoSprite(this.game,t,i,s,e,o)},Phaser.GameObjectFactory.prototype.isoSprite=function(t,i,s,e,o,h){return"undefined"==typeof h&&(h=this.world),h.add(new Phaser.Plugin.Isometric.IsoSprite(this.game,t,i,s,e,o))},Phaser.Plugin.Isometric.prototype.addIsoSprite=function(t,i,s,e,o,h){return Phaser.GameObjectFactory.prototype.isoSprite.call(this.game.add,t,i,s,e,o,h)},Phaser.Utils.Debug.prototype.isoSprite=function(t,i,s){if(t.isoBounds){"undefined"==typeof s&&(s=!0),i=i||"rgba(0,255,0,0.4)";var e=[],o=t.isoBounds.getCorners(),h=-t.game.camera.x,n=-t.game.camera.y;if(this.start(),s){e=[o[1],o[3],o[2],o[6],o[4],o[5],o[1]],e=e.map(function(i){var s=t.game.iso.project(i);return s.x+=h,s.y+=n,s}),this.context.beginPath(),this.context.fillStyle=i,this.context.moveTo(e[0].x,e[0].y);for(var r=1;r<e.length;r++)this.context.lineTo(e[r].x,e[r].y);this.context.fill()}else e=o.slice(0,o.length),e=e.map(function(i){var s=t.game.iso.project(i);return s.x+=h,s.y+=n,s}),this.context.moveTo(e[0].x,e[0].y),this.context.beginPath(),this.context.strokeStyle=i,this.context.lineTo(e[1].x,e[1].y),this.context.lineTo(e[3].x,e[3].y),this.context.lineTo(e[2].x,e[2].y),this.context.lineTo(e[6].x,e[6].y),this.context.lineTo(e[4].x,e[4].y),this.context.lineTo(e[5].x,e[5].y),this.context.lineTo(e[1].x,e[1].y),this.context.lineTo(e[0].x,e[0].y),this.context.lineTo(e[4].x,e[4].y),this.context.moveTo(e[0].x,e[0].y),this.context.lineTo(e[2].x,e[2].y),this.context.moveTo(e[3].x,e[3].y),this.context.lineTo(e[7].x,e[7].y),this.context.lineTo(e[6].x,e[6].y),this.context.moveTo(e[7].x,e[7].y),this.context.lineTo(e[5].x,e[5].y),this.context.stroke(),this.context.closePath();this.stop()}},Phaser.Plugin.Isometric.Octree=function(t,i,s,e,o,h,n,r,a){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,i,s,e,o,h,n,r,a)},Phaser.Plugin.Isometric.Octree.prototype={reset:function(t,i,s,e,o,h,n,r,a){this.maxObjects=n||10,this.maxLevels=r||4,this.level=a||0,this.bounds={x:Math.round(t),y:Math.round(i),z:Math.round(s),widthX:e,widthY:o,height:h,subWidthX:Math.floor(.5*e),subWidthY:Math.floor(.5*o),subHeight:Math.floor(.5*h),frontX:Math.round(t)+Math.floor(.5*e),frontY:Math.round(i)+Math.floor(.5*o),top:Math.round(s)+Math.floor(.5*h)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new Phaser.Plugin.Isometric.Octree(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[1]=new Phaser.Plugin.Isometric.Octree(this.bounds.frontX,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[2]=new Phaser.Plugin.Isometric.Octree(this.bounds.x,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[3]=new Phaser.Plugin.Isometric.Octree(this.bounds.frontX,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[4]=new Phaser.Plugin.Isometric.Octree(this.bounds.x,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[5]=new Phaser.Plugin.Isometric.Octree(this.bounds.frontX,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[6]=new Phaser.Plugin.Isometric.Octree(this.bounds.x,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[7]=new Phaser.Plugin.Isometric.Octree(this.bounds.frontX,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1)},insert:function(t){var i,s=0;if(null!=this.nodes[0]&&(i=this.getIndex(t),-1!=i))return void this.nodes[i].insert(t);if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();s<this.objects.length;)i=this.getIndex(this.objects[s]),-1!=i?this.nodes[i].insert(this.objects.splice(s,1)[0]):s++},getIndex:function(t){var i=-1;return t.x<this.bounds.frontX&&t.frontX<this.bounds.frontX?t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=0:t.z>this.bounds.top&&(i=4):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=2:t.z>this.bounds.top&&(i=6)):t.x>this.bounds.frontX&&(t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=1:t.z>this.bounds.top&&(i=5):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=3:t.z>this.bounds.top&&(i=7))),i},retrieve:function(t){var i,s;if(t instanceof Phaser.Plugin.Isometric.Cube)i=this.objects,s=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects,s=this.getIndex(t.body)}return this.nodes[0]&&(-1!==s?i=i.concat(this.nodes[s].retrieve(t)):(i=i.concat(this.nodes[0].retrieve(t)),i=i.concat(this.nodes[1].retrieve(t)),i=i.concat(this.nodes[2].retrieve(t)),i=i.concat(this.nodes[3].retrieve(t)),i=i.concat(this.nodes[4].retrieve(t)),i=i.concat(this.nodes[5].retrieve(t)),i=i.concat(this.nodes[6].retrieve(t)),i=i.concat(this.nodes[7].retrieve(t)))),i},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},Phaser.Plugin.Isometric.Octree.prototype.constructor=Phaser.Plugin.Isometric.Octree,Phaser.Utils.Debug.prototype.octree=function(t,i){i=i||"rgba(255,0,0,0.3)",this.start();var s,e,o=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=i;var h=new Phaser.Plugin.Isometric.Cube(o.x,o.y,o.z,o.widthX,o.widthY,o.height),n=h.getCorners(),r=-this.game.camera.x,a=-this.game.camera.y;for(e=n.slice(0,n.length),e=e.map(function(t){var i=this.game.iso.project(t);return i.x+=r,i.y+=a,i}),this.context.moveTo(e[0].x,e[0].y),this.context.beginPath(),this.context.strokeStyle=i,this.context.lineTo(e[1].x,e[1].y),this.context.lineTo(e[3].x,e[3].y),this.context.lineTo(e[2].x,e[2].y),this.context.lineTo(e[6].x,e[6].y),this.context.lineTo(e[4].x,e[4].y),this.context.lineTo(e[5].x,e[5].y),this.context.lineTo(e[1].x,e[1].y),this.context.lineTo(e[0].x,e[0].y),this.context.lineTo(e[4].x,e[4].y),this.context.moveTo(e[0].x,e[0].y),this.context.lineTo(e[2].x,e[2].y),this.context.moveTo(e[3].x,e[3].y),this.context.lineTo(e[7].x,e[7].y),this.context.lineTo(e[6].x,e[6].y),this.context.moveTo(e[7].x,e[7].y),this.context.lineTo(e[5].x,e[5].y),this.context.stroke(),this.context.closePath(),s=0;s<t.objects.length;s++)this.body(t.objects[s].sprite,"rgb(0,255,0)",!1)}else for(s=0;s<t.nodes.length;s++)this.octree(t.nodes[s]);this.stop()},Phaser.Plugin.Isometric.Point3=function(t,i,s){t=t||0,i=i||0,s=s||0,this.x=t,this.y=i,this.z=s},Phaser.Plugin.Isometric.Point3.prototype={copyFrom:function(t){return this.setTo(t.x,t.y,t.z)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},set:function(t,i,s){return this.x=t||0,this.y=i||(0!==i?this.x:0),this.z=s||("undefined"==typeof i?this.x:0),this},setTo:function(t,i,s){return this.set(t,i,s)},add:function(t,i){return this.x+=t||0,this.y+=i||0,this},subtract:function(t,i,s){return this.x-=t||0,this.y-=i||0,this.z-=s||0,this},multiply:function(t,i,s){return this.x*=t||1,this.y*=i||1,this.z*=s||1,this},divide:function(t,i,s){return this.x/=t||1,this.y/=i||1,this.z/=s||1,this}},Phaser.Plugin.Isometric.Point3.prototype.constructor=Phaser.Plugin.Isometric.Point3,Phaser.Plugin.Isometric.Point3.add=function(t,i,s){return"undefined"==typeof s&&(s=new Phaser.Plugin.Isometric.Point3),s.x=t.x+i.x,s.y=t.y+i.y,s.z=t.z+i.z,s},Phaser.Plugin.Isometric.Point3.subtract=function(t,i,s){return"undefined"==typeof s&&(s=new Phaser.Plugin.Isometric.Point3),s.x=t.x-i.x,s.y=t.y-i.y,s.z=t.z-i.z,s},Phaser.Plugin.Isometric.Point3.multiply=function(t,i,s){return"undefined"==typeof s&&(s=new Phaser.Plugin.Isometric.Point3),s.x=t.x*i.x,s.y=t.y*i.y,s.z=t.z*i.z,s},Phaser.Plugin.Isometric.Point3.divide=function(t,i,s){return"undefined"==typeof s&&(s=new Phaser.Plugin.Isometric.Point3),s.x=t.x/i.x,s.y=t.y/i.y,s.z=t.z/i.z,s},Phaser.Plugin.Isometric.Point3.equals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z},Phaser.Plugin.Isometric.Projector=function(t,i){this.game=t,this._transform=null,this._projectionAngle=0,this.projectionAngle=i||Phaser.Plugin.Isometric.CLASSIC,this.anchor=new Phaser.Point(.5,0)},Phaser.Plugin.Isometric.CLASSIC=Math.atan(.5),Phaser.Plugin.Isometric.ISOMETRIC=Math.PI/6,Phaser.Plugin.Isometric.MILITARY=Math.PI/4,Phaser.Plugin.Isometric.Projector.prototype={project:function(t,i){return"undefined"==typeof i&&(i=new Phaser.Point),i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1]-t.z,i.x+=this.game.world.width*this.anchor.x,i.y+=this.game.world.height*this.anchor.y,i},projectXY:function(t,i){return"undefined"==typeof i&&(i=new Phaser.Point),i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1],i.x+=this.game.world.width*this.anchor.x,i.y+=this.game.world.height*this.anchor.y,i},unproject:function(t,i,s){"undefined"==typeof i&&(i=new Phaser.Plugin.Isometric.Point3),s=s||0;var e=t.x-this.game.world.x-this.game.world.width*this.anchor.x,o=t.y-this.game.world.y-this.game.world.height*this.anchor.y+s;return i.x=e/(2*this._transform[0])+o/(2*this._transform[1]),i.y=-(e/(2*this._transform[0]))+o/(2*this._transform[1]),i.z=s,i},simpleSort:function(t){t.sort("depth")},topologicalSort:function(t,i,s){function e(t){if(t.isoVisitedFlag===!1){t.isoVisitedFlag=!0;for(var i=t.isoSpritesBehind.length,o=0;i>o&&null!==t.isoSpritesBehind[o];o++)e(t.isoSpritesBehind[o]),t.isoSpritesBehind[o]=null;t[s]=y++}}var o,h;if(t instanceof Phaser.Group)o=t.children,h=!0;else{if(!t.length)return;o=t}s=s||"isoDepth",i="undefined"==typeof i?1.5:i;var n,r,a,c,l,d,u=o.length;for(a=0;u>a;a++){for(n=o[a],d=0,n.isoSpritesBehind||(n.isoSpritesBehind=[]),c=0;u>c;c++)a!=c&&(r=o[c],l=n.body||n.isoBounds,r._isoPosition.x+i<l.frontX-i&&r._isoPosition.y+i<l.frontY-i&&r._isoPosition.z+i<l.top-i&&(n.isoSpritesBehind[d++]=r));n.isoVisitedFlag=!1}var y=0;for(a=0;u>a;a++)e(o[a]);h&&t.sort(s)}},Object.defineProperty(Phaser.Plugin.Isometric.Projector.prototype,"projectionAngle",{get:function(){return this._projectionAngle},set:function(t){t!==this._projectionAngle&&(this._projectionAngle=t,this._transform=[Math.cos(this._projectionAngle),Math.sin(this._projectionAngle)])}}),Phaser.Plugin.Isometric.Body=function(t){this.sprite=t,this.game=t.game,this.type=Phaser.Plugin.Isometric.ISOARCADE,this.enable=!0,this.offset=new Phaser.Plugin.Isometric.Point3,this.position=new Phaser.Plugin.Isometric.Point3(t.isoX,t.isoY,t.isoZ),this.prev=new Phaser.Plugin.Isometric.Point3(this.position.x,this.position.y,this.position.z),this.allowRotation=!0,this.rotation=t.rotation,this.preRotation=t.rotation,this.sourceWidthX=t.texture.frame.width,this.sourceWidthY=t.texture.frame.width,this.sourceHeight=t.texture.frame.height,this.widthX=Math.ceil(.5*t.width),this.widthY=Math.ceil(.5*t.width),this.height=t.height-Math.ceil(.5*t.width),this.halfWidthX=Math.abs(.5*this.widthX),this.halfWidthY=Math.abs(.5*this.widthY),this.halfHeight=Math.abs(.5*this.height),this.center=new Phaser.Plugin.Isometric.Point3(t.isoX+this.halfWidthX,t.isoY+this.halfWidthY,t.isoZ+this.halfHeight),this.velocity=new Phaser.Plugin.Isometric.Point3,this.newVelocity=new Phaser.Plugin.Isometric.Point3,this.deltaMax=new Phaser.Plugin.Isometric.Point3,this.acceleration=new Phaser.Plugin.Isometric.Point3,this.drag=new Phaser.Plugin.Isometric.Point3,this.allowGravity=!0,this.gravity=new Phaser.Plugin.Isometric.Point3,this.bounce=new Phaser.Plugin.Isometric.Point3,this.maxVelocity=new Phaser.Plugin.Isometric.Point3(1e4,1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=Phaser.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.customSeparateZ=!1,this.overlapX=0,this.overlapY=0,this.overlapZ=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.touching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.wasTouching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.blocked={up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.phase=0,this.skipTree=!1,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0,this._dz=0,this._corners=[new Phaser.Plugin.Isometric.Point3(this.x,this.y,this.z),new Phaser.Plugin.Isometric.Point3(this.x,this.y,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x,this.y+this.widthY,this.z),new Phaser.Plugin.Isometric.Point3(this.x,this.y+this.widthY,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y,this.z),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y,this.z+this.height),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y+this.widthY,this.z),new Phaser.Plugin.Isometric.Point3(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]},Phaser.Plugin.Isometric.Body.prototype={updateBounds:function(){var t=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y);t===this._sx&&i===this._sy||(this.widthX=Math.ceil(.5*this.sprite.width),this.widthY=Math.ceil(.5*this.sprite.width),this.height=Math.ceil(this.sprite.height-.5*this.sprite.width),this.halfWidthX=Math.floor(2*this.widthX),this.halfWidthY=Math.floor(2*this.widthY),this.halfHeight=Math.floor(2*this.height),this._sx=t,this._sy=i,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.backX=this.touching.backX,this.wasTouching.backY=this.touching.backY,this.wasTouching.frontX=this.touching.frontX,this.wasTouching.frontY=this.touching.frontY,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.backX=!1,this.touching.backY=!1,this.touching.frontX=!1,this.touching.frontY=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.backX=!1,this.blocked.frontX=!1,this.blocked.backY=!1,this.blocked.backX=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.isoX+(this.widthX*-this.sprite.anchor.x+.5*this.widthX)+this.offset.x,this.position.y=this.sprite.isoY+(this.widthY*this.sprite.anchor.x-.5*this.widthY)+this.offset.y,this.position.z=this.sprite.isoZ-Math.abs(this.sprite.height)*(1-this.sprite.anchor.y)+Math.abs(.5*this.sprite.width)+this.offset.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh===!0)&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.moves&&(this.game.physics.isoArcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed,this.velocity.z*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.z+=this.newVelocity.z,this.position.x===this.prev.x&&this.position.y===this.prev.y&&this.position.z===this.prev.z||(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y+this.velocity.z*this.velocity.z),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds(),this.sprite.outOfBoundsKill&&!this.game.physics.isoArcade.bounds.intersects(this.sprite.isoBounds)&&this.sprite.kill()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),this._reset=!1)},postUpdate:function(){this.enable&&2!==this.phase&&(this.phase=2,this._reset&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.deltaAbsX()>=this.deltaAbsY()&&this.deltaAbsX()>=this.deltaAbsZ()?this.deltaX()<0?this.facing=Phaser.Plugin.Isometric.BACKWARDX:this.deltaX()>0&&(this.facing=Phaser.Plugin.Isometric.FORWARDX):this.deltaAbsY()>=this.deltaAbsX()&&this.deltaAbsY()>=this.deltaAbsZ()?this.deltaY()<0?this.facing=Phaser.Plugin.Isometric.BACKWARDY:this.deltaY()>0&&(this.facing=Phaser.Plugin.Isometric.FORWARDY):this.deltaZ()<0?this.facing=Phaser.Plugin.Isometric.DOWN:this.deltaZ()>0&&(this.facing=Phaser.Plugin.Isometric.UP),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),0!==this.deltaMax.z&&0!==this._dz&&(this._dz<0&&this._dz<-this.deltaMax.z?this._dz=-this.deltaMax.z:this._dz>0&&this._dz>this.deltaMax.z&&(this._dz=this.deltaMax.z)),this.sprite.isoX+=this._dx,this.sprite.isoY+=this._dy,this.sprite.isoZ+=this._dz),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaR()),this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this._reset=!1)},destroy:function(){this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.isoArcade.bounds.x&&this.game.physics.isoArcade.checkCollision.backX?(this.position.x=this.game.physics.isoArcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.backX=!0):this.frontX>this.game.physics.isoArcade.bounds.frontX&&this.game.physics.isoArcade.checkCollision.frontX&&(this.position.x=this.game.physics.isoArcade.bounds.frontX-this.widthX,this.velocity.x*=-this.bounce.x,this.blocked.frontX=!0),this.position.y<this.game.physics.isoArcade.bounds.y&&this.game.physics.isoArcade.checkCollision.backY?(this.position.y=this.game.physics.isoArcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.backY=!0):this.frontY>this.game.physics.isoArcade.bounds.frontY&&this.game.physics.isoArcade.checkCollision.frontY&&(this.position.y=this.game.physics.isoArcade.bounds.frontY-this.widthY,this.velocity.y*=-this.bounce.y,this.blocked.frontY=!0),this.position.z<this.game.physics.isoArcade.bounds.z&&this.game.physics.isoArcade.checkCollision.down?(this.position.z=this.game.physics.isoArcade.bounds.z,this.velocity.z*=-this.bounce.z,this.blocked.down=!0):this.top>this.game.physics.isoArcade.bounds.top&&this.game.physics.isoArcade.checkCollision.up&&(this.position.z=this.game.physics.isoArcade.bounds.top-this.height,this.velocity.z*=-this.bounce.z,this.blocked.up=!0)},setSize:function(t,i,s,e,o,h){"undefined"==typeof e&&(e=this.offset.x),"undefined"==typeof o&&(o=this.offset.y),"undefined"==typeof h&&(h=this.offset.z),this.sourceWidthX=t,this.sourceWidthY=i,this.sourceHeight=s,this.widthX=this.sourceWidthX*this._sx,this.widthY=this.sourceWidthY*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidthX=Math.floor(.5*this.widthX),this.halfWidthY=Math.floor(.5*this.widthY),this.halfHeight=Math.floor(.5*this.height),this.offset.setTo(e,o,h),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight)},reset:function(t,i,s){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t+(this.widthX*-this.sprite.anchor.x+.5*this.widthX)+this.offset.x,this.position.y=i+(this.widthY*this.sprite.anchor.x-.5*this.widthY)+this.offset.y,this.position.z=s-Math.abs(this.sprite.height)*(1-this.sprite.anchor.y)+Math.abs(.5*this.sprite.width)+this.offset.z,this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.sprite._isoPositionChanged=!0},hitTest:function(t,i,s){return Phaser.Plugin.Isometric.Cube.contains(this,t,i,s)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.frontX||this.blocked.frontY||this.blocked.backX||this.blocked.backY},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaAbsZ:function(){return this.deltaZ()>0?this.deltaZ():-this.deltaZ()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.position.z-this.prev.z},deltaR:function(){return this.rotation-this.preRotation},getCorners:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners}},Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"top",{get:function(){return this.position.z+this.height}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"frontX",{get:function(){return this.position.x+this.widthX}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"right",{
get:function(){return this.position.x+this.widthX}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"frontY",{get:function(){return this.position.y+this.widthY}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"bottom",{get:function(){return this.position.y+this.widthY}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),Object.defineProperty(Phaser.Plugin.Isometric.Body.prototype,"z",{get:function(){return this.position.z},set:function(t){this.position.z=t}}),Phaser.Plugin.Isometric.Body.render=function(t,i,s,e){"undefined"==typeof e&&(e=!0),s=s||"rgba(0,255,0,0.4)";var o=[],h=i.getCorners(),n=-i.sprite.game.camera.x,r=-i.sprite.game.camera.y;if(e){o=[h[1],h[3],h[2],h[6],h[4],h[5],h[1]],o=o.map(function(t){var s=i.sprite.game.iso.project(t);return s.x+=n,s.y+=r,s}),t.beginPath(),t.fillStyle=s,t.moveTo(o[0].x,o[0].y);for(var a=1;a<o.length;a++)t.lineTo(o[a].x,o[a].y);t.fill()}else o=h.slice(0,h.length),o=o.map(function(t){var s=i.sprite.game.iso.project(t);return s.x+=n,s.y+=r,s}),t.moveTo(o[0].x,o[0].y),t.beginPath(),t.strokeStyle=s,t.lineTo(o[1].x,o[1].y),t.lineTo(o[3].x,o[3].y),t.lineTo(o[2].x,o[2].y),t.lineTo(o[6].x,o[6].y),t.lineTo(o[4].x,o[4].y),t.lineTo(o[5].x,o[5].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[0].x,o[0].y),t.lineTo(o[4].x,o[4].y),t.moveTo(o[0].x,o[0].y),t.lineTo(o[2].x,o[2].y),t.moveTo(o[3].x,o[3].y),t.lineTo(o[7].x,o[7].y),t.lineTo(o[6].x,o[6].y),t.moveTo(o[7].x,o[7].y),t.lineTo(o[5].x,o[5].y),t.stroke(),t.closePath()},Phaser.Plugin.Isometric.Body.renderBodyInfo=function(t,i){t.line("x: "+i.x.toFixed(2),"y: "+i.y.toFixed(2),"z: "+i.z.toFixed(2),"widthX: "+i.widthX,"widthY: "+i.widthY,"height: "+i.height),t.line("velocity x: "+i.velocity.x.toFixed(2),"y: "+i.velocity.y.toFixed(2),"z: "+i.velocity.z.toFixed(2),"deltaX: "+i._dx.toFixed(2),"deltaY: "+i._dy.toFixed(2),"deltaZ: "+i._dz.toFixed(2)),t.line("acceleration x: "+i.acceleration.x.toFixed(2),"y: "+i.acceleration.y.toFixed(2),"z: "+i.acceleration.z.toFixed(2),"speed: "+i.speed.toFixed(2),"angle: "+i.angle.toFixed(2)),t.line("gravity x: "+i.gravity.x,"y: "+i.gravity.y,"z: "+i.gravity.z),t.line("bounce x: "+i.bounce.x.toFixed(2),"y: "+i.bounce.y.toFixed(2),"z: "+i.bounce.z.toFixed(2)),t.line("touching: ","frontX: "+(i.touching.frontX?1:0)+" frontY: "+(i.touching.frontY?1:0)+" backX: "+(i.touching.backX?1:0)+" backY: "+(i.touching.backY?1:0)+" up: "+(i.touching.up?1:0)+" down: "+(i.touching.down?1:0)),t.line("blocked: ","frontX: "+(i.blocked.frontX?1:0)+" frontY: "+(i.blocked.frontY?1:0)+" backX: "+(i.blocked.backX?1:0)+" backY: "+(i.blocked.backY?1:0)+" up: "+(i.blocked.up?1:0)+" down: "+(i.blocked.down?1:0))},Phaser.Plugin.Isometric.Body.prototype.constructor=Phaser.Plugin.Isometric.Body,Phaser.Utils.Debug.prototype.body=function(t){return function(i,s,e,o){return i.body&&i.body.type===Phaser.Plugin.Isometric.ISOARCADE&&(this.start(),Phaser.Plugin.Isometric.Body.render(this.context,i.body,s,e),o&&this.text(i.depth.toFixed(2),i.x,i.y,s,"12px Courier"),this.stop()),t.call(this,i,s,e)}}(Phaser.Utils.Debug.prototype.body),Phaser.Utils.Debug.prototype.bodyInfo=function(t){return function(i,s,e,o){return i.body&&i.body.type===Phaser.Plugin.Isometric.ISOARCADE&&(this.start(s,e,o,210),Phaser.Plugin.Isometric.Body.renderBodyInfo(this,i.body),this.stop()),t.call(this,i,s,e,o)}}(Phaser.Utils.Debug.prototype.bodyInfo),Phaser.Plugin.Isometric.Arcade=function(t){this.game=t,this.gravity=new Phaser.Plugin.Isometric.Point3,this.bounds=new Phaser.Plugin.Isometric.Cube(0,0,0,.5*t.world.width,.5*t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceXY=!1,this.skipTree=!1,this.useQuadTree=!1,this.quadTree=new Phaser.QuadTree(this.bounds.x,this.bounds.y,this.bounds.widthX,this.bounds.widthY,this.maxObjects,this.maxLevels),this.octree=new Phaser.Plugin.Isometric.Octree(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0,this._dz=0},Phaser.Plugin.Isometric.Arcade.prototype.constructor=Phaser.Plugin.Isometric.Arcade,Phaser.Plugin.Isometric.Arcade.prototype={setBounds:function(t,i,s,e,o,h){this.bounds.setTo(t,i,s,e,o,h)},setBoundsToWorld:function(){this.bounds.setTo(0,0,0,.5*this.game.world.width,.5*this.game.world.width,this.game.world.height)},enable:function(t,i){"undefined"==typeof i&&(i=!0);var s=1;if(Array.isArray(t))for(s=t.length;s--;)t[s]instanceof Phaser.Group?this.enable(t[s].children,i):(this.enableBody(t[s]),i&&t[s].hasOwnProperty("children")&&t[s].children.length>0&&this.enable(t[s],!0));else t instanceof Phaser.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new Phaser.Plugin.Isometric.Body(t))},updateMotion:function(t){this._velocityDelta=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity,t.angularVelocity+=this._velocityDelta,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y),t.velocity.z=this.computeVelocity(3,t,t.velocity.z,t.acceleration.z,t.drag.z,t.maxVelocity.z)},computeVelocity:function(t,i,s,e,o,h){return h=h||1e4,1===t&&i.allowGravity?s+=(this.gravity.x+i.gravity.x)*this.game.time.physicsElapsed:2===t&&i.allowGravity?s+=(this.gravity.y+i.gravity.y)*this.game.time.physicsElapsed:3===t&&i.allowGravity&&(s+=(this.gravity.z+i.gravity.z)*this.game.time.physicsElapsed),e?s+=e*this.game.time.physicsElapsed:o&&(this._drag=o*this.game.time.physicsElapsed,s-this._drag>0?s-=this._drag:s+this._drag<0?s+=this._drag:s=0),s>h?s=h:-h>s&&(s=-h),s},overlap:function(t,i,s,e,o){if(s=s||null,e=e||null,o=o||s,this._result=!1,this._total=0,Array.isArray(i))for(var h=0,n=i.length;n>h;h++)this.collideHandler(t,i[h],s,e,o,!0);else this.collideHandler(t,i,s,e,o,!0);return this._total>0},collide:function(t,i,s,e,o){if(s=s||null,e=e||null,o=o||s,this._result=!1,this._total=0,Array.isArray(i))for(var h=0,n=i.length;n>h;h++)this.collideHandler(t,i[h],s,e,o,!1);else this.collideHandler(t,i,s,e,o,!1);return this._total>0},collideHandler:function(t,i,s,e,o,h){return i||t.type!==Phaser.GROUP?void(t&&i&&t.exists&&i.exists&&(t.type===Phaser.Plugin.Isometric.ISOSPRITE?i.type===Phaser.Plugin.Isometric.ISOSPRITE?this.collideSpriteVsSprite(t,i,s,e,o,h):i.type===Phaser.GROUP&&this.collideSpriteVsGroup(t,i,s,e,o,h):t.type===Phaser.GROUP&&(i.type===Phaser.Plugin.Isometric.ISOSPRITE?this.collideSpriteVsGroup(i,t,s,e,o,h):i.type===Phaser.GROUP&&this.collideGroupVsGroup(t,i,s,e,o,h)))):void this.collideGroupVsSelf(t,s,e,o,h)},collideSpriteVsSprite:function(t,i,s,e,o,h){return t.body&&i.body?(this.separate(t.body,i.body,e,o,h)&&(s&&s.call(o,t,i),this._total++),!0):!1},collideSpriteVsGroup:function(t,i,s,e,o,h){var n,r;if(0!==i.length&&t.body)if(t.body.skipTree||this.skipTree)for(n=0,r=i.children.length;r>n;n++)i.children[n]&&i.children[n].exists&&this.collideSpriteVsSprite(t,i.children[n],s,e,o,h);else for(this.useQuadTree?(this.quadTree.clear(),this.quadTree.reset(this.bounds.x,this.bounds.y,this.bounds.widthX,this.bounds.widthY,this.maxObjects,this.maxLevels),this.quadTree.populate(i),this._potentials=this.quadTree.retrieve(t)):(this.octree.clear(),this.octree.reset(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this.octree.populate(i),this._potentials=this.octree.retrieve(t)),n=0,r=this._potentials.length;r>n;n++)this.separate(t.body,this._potentials[n],e,o,h)&&(s&&s.call(o,t,this._potentials[n].sprite),this._total++)},collideGroupVsSelf:function(t,i,s,e,o){if(0!==t.length)for(var h=t.children.length,n=0;h>n;n++)for(var r=n+1;h>=r;r++)t.children[n]&&t.children[r]&&t.children[n].exists&&t.children[r].exists&&this.collideSpriteVsSprite(t.children[n],t.children[r],i,s,e,o)},collideGroupVsGroup:function(t,i,s,e,o,h){if(0!==t.length&&0!==i.length)for(var n=0,r=t.children.length;r>n;n++)t.children[n].exists&&this.collideSpriteVsGroup(t.children[n],i,s,e,o,h)},separate:function(t,i,s,e,o){return t.enable&&i.enable&&this.intersects(t,i)?s&&s.call(e,t.sprite,i.sprite)===!1?!1:o?!0:(this.forceXY||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.x+t.gravity.x)||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.y+t.gravity.y)?this._result=this.separateX(t,i,o)||this.separateY(t,i,o)||this.separateZ(t,i,o):this._result=this.separateZ(t,i,o)||this.separateX(t,i,o)||this.separateY(t,i,o),this._result):!1},intersects:function(t,i){return t.frontX<=i.x?!1:t.frontY<=i.y?!1:t.x>=i.frontX?!1:t.y>=i.frontY?!1:t.top<=i.z?!1:!(t.z>=i.top)},separateX:function(t,i,s){return t.immovable&&i.immovable?!1:(this._overlap=0,this.intersects(t,i)&&(this._maxOverlap=t.deltaAbsX()+i.deltaAbsX()+this.OVERLAP_BIAS,0===t.deltaX()&&0===i.deltaX()?(t.embedded=!0,i.embedded=!0):t.deltaX()>i.deltaX()?(this._overlap=t.frontX-i.x,this._overlap>this._maxOverlap||t.checkCollision.frontX===!1||i.checkCollision.backX===!1?this._overlap=0:(t.touching.none=!1,t.touching.frontX=!0,i.touching.none=!1,i.touching.backX=!0)):t.deltaX()<i.deltaX()&&(this._overlap=t.x-i.widthX-i.x,-this._overlap>this._maxOverlap||t.checkCollision.backX===!1||i.checkCollision.frontX===!1?this._overlap=0:(t.touching.none=!1,t.touching.backX=!0,i.touching.none=!1,i.touching.frontX=!0)),0!==this._overlap)?(t.overlapX=this._overlap,i.overlapX=this._overlap,s||t.customSeparateX||i.customSeparateX?!0:(this._velocity1=t.velocity.x,this._velocity2=i.velocity.x,t.immovable||i.immovable?t.immovable?i.immovable||(i.x+=this._overlap,i.velocity.x=this._velocity1-this._velocity2*i.bounce.x):(t.x=t.x-this._overlap,t.velocity.x=this._velocity2-this._velocity1*t.bounce.x):(this._overlap*=.5,t.x=t.x-this._overlap,i.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.x=this._average+this._newVelocity1*t.bounce.x,i.velocity.x=this._average+this._newVelocity2*i.bounce.x),!0)):!1)},separateY:function(t,i,s){return t.immovable&&i.immovable?!1:(this._overlap=0,this.intersects(t,i)&&(this._maxOverlap=t.deltaAbsY()+i.deltaAbsY()+this.OVERLAP_BIAS,0===t.deltaY()&&0===i.deltaY()?(t.embedded=!0,i.embedded=!0):t.deltaY()>i.deltaY()?(this._overlap=t.frontY-i.y,this._overlap>this._maxOverlap||t.checkCollision.frontY===!1||i.checkCollision.backY===!1?this._overlap=0:(t.touching.none=!1,t.touching.frontY=!0,i.touching.none=!1,i.touching.backY=!0)):t.deltaY()<i.deltaY()&&(this._overlap=t.y-i.widthY-i.y,-this._overlap>this._maxOverlap||t.checkCollision.backY===!1||i.checkCollision.frontY===!1?this._overlap=0:(t.touching.none=!1,t.touching.backY=!0,i.touching.none=!1,i.touching.frontY=!0)),0!==this._overlap)?(t.overlapY=this._overlap,i.overlapY=this._overlap,s||t.customSeparateY||i.customSeparateY?!0:(this._velocity1=t.velocity.y,this._velocity2=i.velocity.y,t.immovable||i.immovable?t.immovable?i.immovable||(i.y+=this._overlap,i.velocity.y=this._velocity1-this._velocity2*i.bounce.y):(t.y=t.y-this._overlap,t.velocity.y=this._velocity2-this._velocity1*t.bounce.y):(this._overlap*=.5,t.y=t.y-this._overlap,i.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.y=this._average+this._newVelocity1*t.bounce.y,i.velocity.y=this._average+this._newVelocity2*i.bounce.y),!0)):!1)},separateZ:function(t,i,s){return t.immovable&&i.immovable?!1:(this._overlap=0,this.intersects(t,i)&&(this._maxOverlap=t.deltaAbsZ()+i.deltaAbsZ()+this.OVERLAP_BIAS,0===t.deltaZ()&&0===i.deltaZ()?(t.embedded=!0,i.embedded=!0):t.deltaZ()>i.deltaZ()?(this._overlap=t.top-i.z,this._overlap>this._maxOverlap||t.checkCollision.down===!1||i.checkCollision.up===!1?this._overlap=0:(t.touching.none=!1,t.touching.down=!0,i.touching.none=!1,i.touching.up=!0)):t.deltaZ()<i.deltaZ()&&(this._overlap=t.z-i.top,-this._overlap>this._maxOverlap||t.checkCollision.up===!1||i.checkCollision.down===!1?this._overlap=0:(t.touching.none=!1,t.touching.up=!0,i.touching.none=!1,i.touching.down=!0)),0!==this._overlap)?(t.overlapZ=this._overlap,i.overlapZ=this._overlap,s||t.customSeparateY||i.customSeparateZ?!0:(this._velocity1=t.velocity.z,this._velocity2=i.velocity.z,t.immovable||i.immovable?t.immovable?i.immovable||(i.z+=this._overlap,i.velocity.z=this._velocity1-this._velocity2*i.bounce.z,t.moves&&(i.x+=t.x-t.prev.x,i.y+=t.y-t.prev.y)):(t.z=t.z-this._overlap,t.velocity.z=this._velocity2-this._velocity1*t.bounce.z,i.moves&&(t.x+=i.x-i.prev.x,t.y+=i.y-i.prev.y)):(this._overlap*=.5,t.z=t.z-this._overlap,i.z+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.z=this._average+this._newVelocity1*t.bounce.z,i.velocity.z=this._average+this._newVelocity2*i.bounce.z),!0)):!1)},distanceBetween:function(t,i){return this._dx=t.x-i.x,this._dy=t.y-i.y,this._dz=t.z-i.z,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)},distanceToXY:function(t,i,s){return this._dx=t.x-i,this._dy=t.y-s,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXYZ:function(t,i,s,e){return this._dx=t.x-i,this._dy=t.y-s,this._dz=t.z-e,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)},distanceToPointer:function(t,i){i=i||this.game.input.activePointer;var s=this.game.iso.unproject(i.position,void 0,t.z);s.z=t.z;var e=this.anglesToXYZ(t,s.x,s.y,s.z);return e.r},anglesToXYZ:function(t,i,s,e){var o=this.distanceToXYZ(t,i,s,e),h=Math.atan2(s-t.y,i-t.x),n=Math.acos((e-t.z)/o);return{r:o,theta:h,phi:n}},angleToPointer:function(t,i){i=i||this.game.input.activePointer;var s=this.game.iso.unproject(i.position,void 0,t.z);s.z=t.z;var e=this.anglesToXYZ(t,s.x,s.y,s.z);return e.theta},velocityFromAngles:function(t,i,s,e){return void 0===i&&(i=Math.sin(Math.PI/2)),void 0===s&&(s=60),e=e||new Phaser.Point,new Phaser.Plugin.Isometric.Point3(Math.cos(t)*Math.sin(i)*s,Math.sin(t)*Math.sin(i)*s,Math.cos(i)*s)},accelerateToXYZ:function(t,i,s,e,o,h,n,r){void 0===o&&(o=60),void 0===h&&(h=500),void 0===n&&(n=500),void 0===r&&(r=500);var a=this.anglesToXYZ(t.body,i,s,e),c=this.velocityFromAngles(a.theta,a.phi,o);return t.body.acceleration.setTo(c.x,c.y,c.z),t.body.maxVelocity.setTo(h,n,r),a.theta},moveToXYZ:function(t,i,s,e,o,h){"undefined"==typeof o&&(o=60),"undefined"==typeof h&&(h=0),h>0&&(o=this.distanceToXYZ(t.body,i,s,e)/(h/1e3));var n=this.anglesToXYZ(t.body,i,s,e),r=this.velocityFromAngles(n.theta,n.phi,o);return t.body.velocity.copyFrom(r),n.theta},moveToObject:function(t,i,s,e){return this.moveToXYZ(t,i.x,i.y,i.z,s,e)},moveToPointer:function(t,i,s,e){s=s||this.game.input.activePointer;var o=this.game.iso.unproject(s.position,void 0,t.body.z);o.z=t.body.z,"undefined"==typeof i&&(i=60),"undefined"==typeof e&&(e=0),e>0&&(i=this.distanceToXYZ(t.body,o.x,o.y,o.z)/(e/1e3));var h=this.anglesToXYZ(t.body,o.x,o.y,o.z),n=this.velocityFromAngles(h.theta,h.phi,i);return t.body.velocity.x=n.x,t.body.velocity.y=n.y,h.theta}},Phaser.Physics.prototype.isoArcade=null,Phaser.Physics.prototype.parseConfig=function(t){return function(){return this.config.hasOwnProperty("isoArcade")&&this.config.isoArcade===!0&&Phaser.Plugin.Isometric.hasOwnProperty("IsoArcade")&&(this.isoArcade=new Phaser.Plugin.Isometric(this.game,this.config)),t.call(this)}}(Phaser.Physics.prototype.parseConfig),Phaser.Physics.prototype.startSystem=function(t){return function(i){return i===Phaser.Plugin.Isometric.ISOARCADE&&null===this.isoArcade&&(this.isoArcade=new Phaser.Plugin.Isometric.Arcade(this.game),this.setBoundsToWorld()),t.call(this,i)}}(Phaser.Physics.prototype.startSystem),Phaser.Physics.prototype.enable=function(t){return function(i,s){return s===Phaser.Plugin.Isometric.ISOARCADE&&this.isoArcade&&this.isoArcade.enable(i),t.call(this,i,s)}}(Phaser.Physics.prototype.enable),Phaser.Physics.prototype.setBoundsToWorld=function(t){return function(){return this.isoArcade&&this.isoArcade.setBoundsToWorld(),t.call(this)}}(Phaser.Physics.prototype.setBoundsToWorld),Phaser.Physics.prototype.destroy=function(t){return function(){return this.isoArcade=null,t.call(this)}}(Phaser.Physics.prototype.destroy);